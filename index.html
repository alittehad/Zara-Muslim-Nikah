<!DOCTYPE html>
<html>
<head>
  <title>Nikah Site - User</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body{ font-family:sans-serif; padding:20px;}
    .hidden{ display:none;}
    #preview img{ width:150px; margin-top:10px;}
  </style>
</head>
<body>

<!-- Top Nikah Image -->
<div style="text-align:center; margin-bottom:20px;">
  <img src="https://res.cloudinary.com/dlsqxs7zl/image/upload/v1690000000/nikah.jpg" 
       alt="Nikah" style="width:100%; max-width:600px; border-radius:10px;">
</div>

<h2>User Login / Signup</h2>
<div id="authDiv">
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="signup()">Sign Up</button>
  <button onclick="login()">Login</button>
</div>

<div id="userDiv" class="hidden">
  <h3>Welcome, <span id="userEmail"></span></h3>
  <input type="file" id="photo">
  <button onclick="uploadPhoto()">Upload Photo</button>
  <div id="preview"></div>
  <button onclick="logout()">Logout</button>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD7x6epAwfshYNzc4G8JvmE4Bu3UNdMB5U",
    authDomain: "nikah-c234b.firebaseapp.com",
    databaseURL: "https://nikah-c234b-default-rtdb.firebaseio.com",
    projectId: "nikah-c234b",
    storageBucket: "nikah-c234b.appspot.com",
    messagingSenderId: "760906560668",
    appId: "1:760906560668:web:0a2c16a47aeaec26482959",
    measurementId: "G-ENL0FZPEEF"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  const adminEmail = "ngogrant454@gmail.com";

  auth.onAuthStateChanged(user=>{
    if(user){
      document.getElementById("authDiv").classList.add("hidden");
      document.getElementById("userEmail").innerText = user.email;
      if(user.email === adminEmail){
        window.location.href = "admin.html"; // redirect admin
      }else{
        document.getElementById("userDiv").classList.remove("hidden");
      }
    }else{
      document.getElementById("authDiv").classList.remove("hidden");
      document.getElementById("userDiv").classList.add("hidden");
    }
  });

  function signup(){
    const email=document.getElementById("email").value;
    const password=document.getElementById("password").value;
    auth.createUserWithEmailAndPassword(email,password)
      .then(()=>alert("Signup success!"))
      .catch(err=>alert(err.message));
  }

  function login(){
    const email=document.getElementById("email").value;
    const password=document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email,password)
      .then(()=>console.log("Logged in"))
      .catch(err=>alert(err.message));
  }

  function logout(){ auth.signOut(); }

  async function uploadPhoto(){
    const file=document.getElementById("photo").files[0];
    if(!file){ alert("Select photo!"); return; }
    const formData=new FormData();
    formData.append('file',file);
    formData.append('upload_preset','profiles');
    const cloudName='dlsqxs7zl';
    const res=await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`,{
      method:'POST', body:formData
    });
    const data=await res.json();
    document.getElementById("preview").innerHTML=`<img src="${data.secure_url}">`;
    const userId = auth.currentUser.uid;
    db.ref("users/"+userId).set({
      email:auth.currentUser.email,
      photo_url:data.secure_url,
      status:"pending"
    });
    alert("Photo uploaded! Waiting admin approval.");
  }
</script>

</body>
</html>
