<!DOCTYPE html>
<html>
<head>
<title>Zara Muslim Nikah</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{font-family:Segoe UI;margin:0;background:#f4f6f9;}
header{background:#008080;color:white;padding:15px;text-align:center;font-size:22px;}
.filters{text-align:center;padding:15px;}
input,select{padding:8px;margin:5px;border-radius:5px;border:1px solid #ccc;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;padding:20px;}
.card{background:white;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1);overflow:hidden;cursor:pointer;transition:0.3s;}
.card:hover{transform:translateY(-5px);}
.card img{width:100%;height:220px;object-fit:cover;}
.card-body{text-align:center;padding:15px;}
.name{font-weight:bold;font-size:18px;}
.city{color:gray;font-size:14px;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;}
.modal-content{background:white;padding:20px;border-radius:10px;width:90%;max-width:400px;}
button{padding:8px 15px;background:#008080;color:white;border:none;border-radius:5px;cursor:pointer;}
</style>
</head>

<body>

<header>Zara Muslim Nikah</header>

<div class="filters">
<input type="text" id="search" placeholder="Search name...">
<select id="genderFilter">
<option value="">All</option>
<option value="Male">Male</option>
<option value="Female">Female</option>
</select>
<button onclick="googleLogin()">Login</button>
</div>

<div class="grid" id="profileGrid"></div>

<div class="modal" id="profileModal">
<div class="modal-content" id="modalContent"></div>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAhrYtSAdorLMYgBIPeEnXk2nFDG_M65Wc",
  authDomain: "zara-muslim-nikah.firebaseapp.com",
  databaseURL: "https://zara-muslim-nikah-default-rtdb.firebaseio.com",
  projectId: "zara-muslim-nikah"
});

const auth=firebase.auth();
const db=firebase.database();

let allProfiles=[];

function googleLogin(){
 const provider=new firebase.auth.GoogleAuthProvider();
 auth.signInWithPopup(provider);
}

db.ref("users").orderByChild("status").equalTo("approved")
.on("value",snap=>{
 allProfiles=[];
 snap.forEach(child=>{
   allProfiles.push({id:child.key,...child.val()});
 });
 renderProfiles(allProfiles);
});

function renderProfiles(data){
 const grid=document.getElementById("profileGrid");
 grid.innerHTML="";
 data.forEach(user=>{
   grid.innerHTML+=`
     <div class="card" onclick="openProfile('${user.id}')">
       <img src="${user.photo}">
       <div class="card-body">
         <div class="name">${user.name}</div>
         <div class="city">${user.city}</div>
       </div>
     </div>
   `;
 });
}

document.getElementById("search").addEventListener("input",filterProfiles);
document.getElementById("genderFilter").addEventListener("change",filterProfiles);

function filterProfiles(){
 const search=document.getElementById("search").value.toLowerCase();
 const gender=document.getElementById("genderFilter").value;

 const filtered=allProfiles.filter(p=>{
   return p.name.toLowerCase().includes(search) &&
         (gender==="" || p.gender===gender);
 });
 renderProfiles(filtered);
}

function openProfile(uid){
 if(!auth.currentUser){
   googleLogin();
   return;
 }

 db.ref("users/"+uid).once("value").then(snap=>{
   const d=snap.val();
   document.getElementById("modalContent").innerHTML=`
     <h3>${d.name}</h3>
     <img src="${d.photo}" width="100%">
     <p><b>Age:</b> ${d.age}</p>
     <p><b>City:</b> ${d.city}</p>
     <p><b>Bio:</b> ${d.bio}</p>
     <button onclick="sendInterest('${uid}')">Send Interest</button>
     <br><br>
     <button onclick="closeModal()">Close</button>
   `;
   document.getElementById("profileModal").style.display="flex";
 });
}

function closeModal(){
 document.getElementById("profileModal").style.display="none";
}

function sendInterest(receiverId){
 const sender=auth.currentUser.uid;
 db.ref("interests/"+receiverId+"/"+sender).set(true);
 alert("Interest Sent");
}

auth.onAuthStateChanged(user=>{
 if(user){
   db.ref("users/"+user.uid).once("value").then(snap=>{
     if(snap.exists() && snap.val().status==="pending"){
       alert("Your profile is waiting for admin approval");
     }
   });
 }
});
</script>

</body>
</html>
