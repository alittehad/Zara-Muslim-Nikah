<!DOCTYPE html>
<html>
<head>
<title>Zara Muslim Nikah</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body{font-family:Arial;background:#fdf6f0;text-align:center;}
input,select,textarea{padding:8px;margin:5px;width:90%;max-width:300px;}
button{padding:8px 15px;background:#4CAF50;color:white;border:none;}
.hidden{display:none;}
</style>
</head>
<body>

<h2>Zara Muslim Nikah</h2>

<div id="loginDiv">
<button onclick="login()">Login with Google</button>
</div>

<div id="profileDiv" class="hidden">
<h3>Create Profile</h3>

<input id="name" placeholder="Full Name"><br>
<input id="age" placeholder="Age"><br>
<input id="city" placeholder="City"><br>

<select id="gender">
<option value="Male">Male</option>
<option value="Female">Female</option>
</select><br>

<textarea id="bio" placeholder="About you"></textarea><br>

<input type="file" id="photo"><br>

<button onclick="saveProfile()">Submit Profile</button>
<p id="status"></p>

<button onclick="logout()">Logout</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAhrYtSAdorLMYgBIPeEnXk2nFDG_M65Wc",
  authDomain: "zara-muslim-nikah.firebaseapp.com",
  databaseURL: "https://zara-muslim-nikah-default-rtdb.firebaseio.com",
  projectId: "zara-muslim-nikah"
});

const auth=firebase.auth();
const db=firebase.database();

function login(){
 const provider=new firebase.auth.GoogleAuthProvider();
 auth.signInWithPopup(provider);
}

auth.onAuthStateChanged(user=>{
 if(user){
  db.ref("users/"+user.uid).once("value").then(snap=>{
    if(snap.exists() && snap.val().role==="admin"){
      window.location="admin.html";
    }else{
      document.getElementById("loginDiv").classList.add("hidden");
      document.getElementById("profileDiv").classList.remove("hidden");
    }
  });
 }
});

function logout(){auth.signOut();}

async function saveProfile(){
 try{
  const file=document.getElementById("photo").files[0];
  if(!file){alert("Select photo");return;}

  const formData=new FormData();
  formData.append("file",file);
  formData.append("upload_preset","profiles");

  const res=await fetch("https://api.cloudinary.com/v1_1/dlsqxs7zl/image/upload",{
    method:"POST",body:formData
  });

  const data=await res.json();

  db.ref("users/"+auth.currentUser.uid).set({
    name:document.getElementById("name").value,
    age:document.getElementById("age").value,
    city:document.getElementById("city").value,
    gender:document.getElementById("gender").value,
    bio:document.getElementById("bio").value,
    photo:data.secure_url,
    status:"pending",
    role:"user"
  });

  document.getElementById("status").innerText="Profile submitted. Wait for admin approval.";
 }catch(e){
  alert("Error saving profile");
 }
}
</script>

</body>
</html>
