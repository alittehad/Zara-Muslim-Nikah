<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zara Muslim Nikah</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{margin:0;font-family:Segoe UI;background:#f4f6f9}
header{background:#0f766e;color:white;padding:15px;text-align:center;font-size:22px}
.topbar{text-align:center;padding:10px}
button{padding:8px 14px;border:none;border-radius:6px;background:#0f766e;color:white;cursor:pointer}
button:hover{background:#0b5e57}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
gap:20px;
padding:20px;
}

.card{
background:white;
border-radius:14px;
box-shadow:0 4px 15px rgba(0,0,0,0.08);
overflow:hidden;
cursor:pointer;
transition:0.3s;
}

.card:hover{transform:translateY(-5px)}

.card img{
width:100%;
height:260px;
object-fit:contain;
background:#eee;
}

.card-body{text-align:center;padding:12px}
.name{font-weight:bold;font-size:18px}
.city{color:gray;font-size:14px}
.badge{font-size:13px;margin-top:4px}
.premium{color:gold}
.featured{color:red}

.modal{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.6);
display:none;
justify-content:center;
align-items:center;
}

.modal-content{
background:white;
width:95%;
max-width:500px;
max-height:90vh;
overflow-y:auto;
border-radius:12px;
padding:20px;
position:relative;
}

.modal-content img{
width:100%;
height:auto;
object-fit:contain;
}

.close{
position:absolute;
top:10px;
right:15px;
font-size:18px;
cursor:pointer;
}
</style>
</head>
<body>

<header>Zara Muslim Nikah</header>

<div class="topbar">
<button id="loginBtn" onclick="handleAuth()">Login</button>
<button onclick="goAdd()">‡§∞‡§ø‡§∂‡•ç‡§§‡§æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
</div>

<div class="grid" id="profileGrid"></div>

<div class="modal" id="profileModal">
<div class="modal-content" id="modalContent"></div>
</div>

<script>

firebase.initializeApp({
 apiKey:"YOUR_API_KEY",
 authDomain:"YOUR_AUTH_DOMAIN",
 databaseURL:"YOUR_DATABASE_URL",
 projectId:"YOUR_PROJECT_ID"
});

const auth=firebase.auth();
const db=firebase.database();
let profiles=[];

/* LOGIN */
function handleAuth(){
 if(auth.currentUser){ auth.signOut(); }
 else{
   const provider=new firebase.auth.GoogleAuthProvider();
   auth.signInWithPopup(provider);
 }
}

auth.onAuthStateChanged(user=>{
 document.getElementById("loginBtn").innerText=user?"Logout":"Login";
});

/* ADD PAGE */
function goAdd(){
 if(!auth.currentUser){ alert("Login required"); return; }
 window.location="poster.html";
}

/* LOAD PROFILES */
db.ref("users").on("value",snap=>{
 profiles=[];
 snap.forEach(child=>{
   const d=child.val();
   if(d.status==="approved"){
     profiles.push({id:child.key,...d});
   }
 });
 sortProfiles();
 renderProfiles();
});

/* SORT */
function sortProfiles(){
 profiles.sort((a,b)=>{
   if(a.featured && !b.featured) return -1;
   if(!a.featured && b.featured) return 1;
   return (b.createdAt||0)-(a.createdAt||0);
 });
}

/* RENDER */
function renderProfiles(){
 const grid=document.getElementById("profileGrid");
 grid.innerHTML="";
 profiles.forEach(p=>{
   grid.innerHTML+=`
   <div class="card" onclick="openProfile('${p.id}')">
     <img src="${p.photo}">
     <div class="card-body">
       <div class="name">${p.name}</div>
       <div class="city">${p.city}</div>
       ${p.premium?"<div class='badge premium'>üèÜ Premium</div>":""}
       ${p.featured?"<div class='badge featured'>üî• Featured</div>":""}
       <div id="like-${p.id}">‚ù§Ô∏è 0</div>
     </div>
   </div>`;

   db.ref("likes/"+p.id).once("value").then(s=>{
     document.getElementById("like-"+p.id).innerText="‚ù§Ô∏è "+s.numChildren();
   });
 });
}

/* OPEN PROFILE */
function openProfile(id){
 if(!auth.currentUser){ alert("Login required"); return; }
 db.ref("users/"+id).once("value").then(s=>{
   const d=s.val();
   document.getElementById("modalContent").innerHTML=`
   <div class="close" onclick="closeModal()">‚úñ</div>
   <h3>${d.name}</h3>
   <img src="${d.photo}">
   <p><b>Age:</b> ${d.age}</p>
   <p><b>City:</b> ${d.city}</p>
   <p><b>Education:</b> ${d.education}</p>
   <p><b>Profession:</b> ${d.profession}</p>
   <p><b>Bio:</b> ${d.bio}</p>

   <button onclick="toggleLike('${id}')">‚ù§Ô∏è Like</button>
   <button onclick="sendInterest('${id}')">üîî Interest</button>
   <button onclick="startChat()">üí¨ Chat</button>
   `;
   document.getElementById("profileModal").style.display="flex";
 });
}

function closeModal(){
 document.getElementById("profileModal").style.display="none";
}

function toggleLike(id){
 const uid=auth.currentUser.uid;
 const ref=db.ref("likes/"+id+"/"+uid);
 ref.once("value").then(s=>{
   if(s.exists()) ref.remove();
   else ref.set(true);
 });
}

function sendInterest(id){
 const sender=auth.currentUser;
 db.ref("interests/"+id+"/"+sender.uid).set({
   name:sender.displayName,
   time:Date.now()
 });
 alert("Interest Sent");
}

function startChat(){
 const uid=auth.currentUser.uid;
 db.ref("subscriptions/"+uid).once("value").then(s=>{
   if(s.exists() && s.val().expiry>Date.now()){
     window.open("https://wa.me/918806940156","_blank");
   }else{
     alert("Premium required");
     window.location="payment.html";
   }
 });
}

</script>
</body>
</html>
