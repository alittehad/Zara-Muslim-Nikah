<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Zara Muslim Nikah</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{font-family:Segoe UI;background:#f4f6f9;margin:0}
header{background:#008080;color:white;padding:15px;text-align:center;font-size:22px}

.filters{text-align:center;padding:10px}
button{padding:8px 12px;border:none;border-radius:5px;background:#008080;color:white;cursor:pointer}
button:hover{background:#006666}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
gap:20px;
padding:20px;
}

.card{
background:white;
border-radius:15px;
box-shadow:0 4px 15px rgba(0,0,0,0.1);
overflow:hidden;
cursor:pointer;
transition:0.3s;
position:relative;
}

.card:hover{
transform:translateY(-5px);
box-shadow:0 8px 20px rgba(0,0,0,0.2);
}

.card img{
width:100%;
height:250px;
object-fit:contain;
background:#eee;
}

.card-body{text-align:center;padding:15px}
.name{font-weight:bold;font-size:18px}
.city{color:gray}
.premium{color:gold;font-size:14px}

.admin-buttons button{
width:48%;
margin:2px;
background:#444;
}

.modal{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.6);
display:none;
justify-content:center;
align-items:center;
}

.modal-content{
background:white;
padding:20px;
border-radius:10px;
width:95%;
max-width:500px;
max-height:90vh;
overflow-y:auto;
position:relative;
}

.modal-content img{
width:100%;
height:auto;
object-fit:contain;
margin-bottom:10px;
}
</style>
</head>
<body>

<header>Zara Muslim Nikah</header>

<div class="filters">
<button id="loginBtn" onclick="handleAuth()">Login</button>
<button onclick="goToAddProfile()">‡§∞‡§ø‡§∂‡•ç‡§§‡§æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
</div>

<div class="grid" id="profileGrid"></div>

<div class="modal" id="profileModal">
<div class="modal-content" id="modalContent"></div>
</div>

<script>

firebase.initializeApp({
  apiKey: "AIzaSyAhrYtSAdorLMYgBIPeEnXk2nFDG_M65Wc",
  authDomain: "zara-muslim-nikah.firebaseapp.com",
  databaseURL: "https://zara-muslim-nikah-default-rtdb.firebaseio.com",
  projectId: "zara-muslim-nikah"
});

const auth=firebase.auth();
const db=firebase.database();
const adminEmail="ngogrant454@gmail.com";
let allProfiles=[];

/* LOGIN */
function handleAuth(){
 if(auth.currentUser){
   auth.signOut();
 }else{
   const provider=new firebase.auth.GoogleAuthProvider();
   auth.signInWithPopup(provider);
 }
}

auth.onAuthStateChanged(user=>{
 document.getElementById("loginBtn").innerText=user?"Logout":"Login";
 renderProfiles();
});

/* ADD PROFILE */
function goToAddProfile(){
 if(!auth.currentUser){
   alert("‡§™‡§π‡§≤‡•á ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç");
   return;
 }
 window.location="add-profile.html";
}

/* LOAD PROFILES */
db.ref("users").on("value",snap=>{
 allProfiles=[];
 snap.forEach(child=>{
   allProfiles.push({id:child.key,...child.val()});
 });

 // Newest first
 allProfiles=allProfiles.reverse();

 renderProfiles();
});

/* RENDER */
function renderProfiles(){
 const grid=document.getElementById("profileGrid");
 const user=auth.currentUser;
 grid.innerHTML="";

 allProfiles.forEach(p=>{

   if(!user && p.status!=="approved") return;
   if(user && user.email!==adminEmail && p.status!=="approved") return;

   let adminBtns="";
   if(user && user.email===adminEmail && p.status==="pending"){
     adminBtns=`
     <div class="admin-buttons">
       <button onclick="event.stopPropagation();approveProfile('${p.id}')">Approve</button>
       <button onclick="event.stopPropagation();rejectProfile('${p.id}')">Reject</button>
     </div>`;
   }

   grid.innerHTML+=`
   <div class="card" onclick="openProfile('${p.id}')">
     <img src="${p.photo}">
     <div class="card-body">
       <div class="name">${p.name}</div>
       <div class="city">${p.city}</div>
       ${p.premium?"<div class='premium'>üèÜ Premium</div>":""}
       ${adminBtns}
     </div>
   </div>`;
 });
}

/* OPEN PROFILE */
function openProfile(uid){
 const user=auth.currentUser;

 if(!user){
   alert("Profile dekhne ke liye login karein");
   return;
 }

 db.ref("users/"+uid).once("value").then(snap=>{
  const d=snap.val();

  if(user.email!==adminEmail && d.status!=="approved"){
    alert("Waiting for approval");
    return;
  }

  let adminBtns="";
  if(user.email===adminEmail && d.status==="pending"){
    adminBtns=`
      <button onclick="approveProfile('${uid}')">Approve</button>
      <button onclick="rejectProfile('${uid}')">Reject</button>`;
  }

  document.getElementById("modalContent").innerHTML=`
   <button onclick="closeModal()" style="position:absolute;top:10px;right:10px">‚úñ</button>
   <h3>${d.name}</h3>
   <img src="${d.photo}">
   <p><b>Age:</b> ${d.age}</p>
   <p><b>Father:</b> ${d.fatherName}</p>
   <p><b>Mother:</b> ${d.motherName}</p>
   <p><b>City:</b> ${d.city}</p>
   <p><b>Education:</b> ${d.education}</p>
   <p><b>Profession:</b> ${d.profession}</p>
   <p><b>Religion:</b> ${d.religion}</p>
   <p><b>Phone:</b> ${d.phone}</p>
   <p><b>Bio:</b> ${d.bio}</p>

   <button onclick="likeProfile('${uid}')">‚ù§Ô∏è Like</button>
   <button onclick="sendInterest('${uid}')">üîî Interest</button>
   <button onclick="startChat()">üí¨ Chat Now</button>

   ${adminBtns}
  `;

  document.getElementById("profileModal").style.display="flex";
 });
}

function closeModal(){
 document.getElementById("profileModal").style.display="none";
}

/* LIKE */
function likeProfile(id){
 db.ref("likes/"+id+"/"+auth.currentUser.uid).set(true);
 alert("Liked ‚ù§Ô∏è");
}

/* INTEREST */
function sendInterest(id){
 db.ref("interests/"+id+"/"+auth.currentUser.uid).set(true);
 alert("Interest Sent üîî");
}

/* CHAT WITH PAYMENT */
function startChat(){
 const user=auth.currentUser;

 db.ref("payments/"+user.uid).once("value").then(snap=>{
   if(snap.exists()){
     window.open("https://wa.me/918806940156","_blank");
   }else{
     window.location="payment.html";
   }
 });
}

/* ADMIN */
function approveProfile(uid){
 db.ref("users/"+uid).update({status:"approved"});
 alert("Approved");
 closeModal();
}

function rejectProfile(uid){
 db.ref("users/"+uid).update({status:"rejected"});
 alert("Rejected");
 closeModal();
}

</script>

</body>
</html>
