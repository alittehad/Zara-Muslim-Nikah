<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Add Profile - Zara Muslim Nikah</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{font-family:Segoe UI;background:#f4f6f9;margin:0;padding:0;}
header{background:#008080;color:white;padding:15px;text-align:center;font-size:22px;}
.card-form{background:white;padding:20px;margin:20px auto;max-width:500px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
.card-form input, .card-form select, .card-form textarea, .card-form button{width:100%;padding:10px;margin:10px 0;border-radius:5px;border:1px solid #ccc;}
button{background:#008080;color:white;border:none;cursor:pointer;}
button:hover{background:#006666;}
</style>
</head>

<body>
<header>Add Profile</header>

<div class="card-form">
<input id="name" placeholder="Full Name" required>
<input id="age" type="number" placeholder="Age" required>
<select id="gender" required>
  <option value="">Select Gender</option>
  <option value="Male">Male</option>
  <option value="Female">Female</option>
</select>
<input id="fatherName" placeholder="Father's Name">
<select id="maritalStatus">
  <option value="">Marital Status</option>
  <option value="Unmarried">Unmarried</option>
  <option value="Married">Married</option>
  <option value="Divorced">Divorced</option>
  <option value="Widowed">Widowed</option>
</select>
<input id="children" type="number" placeholder="Number of Children (if any)">
<input id="city" placeholder="City">
<input id="education" placeholder="Education">
<input id="profession" placeholder="Profession">
<input id="religion" placeholder="Religion/Sect">
<input id="phone" placeholder="Phone/WhatsApp">
<textarea id="bio" placeholder="Short Bio / About Yourself"></textarea>
<input type="file" id="photo" accept="image/*">
<button onclick="submitProfile()">Submit Profile</button>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAhrYtSAdorLMYgBIPeEnXk2nFDG_M65Wc",
  authDomain: "zara-muslim-nikah.firebaseapp.com",
  databaseURL: "https://zara-muslim-nikah-default-rtdb.firebaseio.com",
  projectId: "zara-muslim-nikah"
});

const auth=firebase.auth();
const db=firebase.database();

// Redirect if not logged in
auth.onAuthStateChanged(user=>{
  if(!user) window.location.href="index.html";
});

// Submit Profile
function submitProfile(){
  const user = auth.currentUser;
  if(!user){ alert("Login first"); return; }

  // Collect form data
  const name = document.getElementById("name").value;
  const age = document.getElementById("age").value;
  const gender = document.getElementById("gender").value;
  const fatherName = document.getElementById("fatherName").value;
  const maritalStatus = document.getElementById("maritalStatus").value;
  const children = document.getElementById("children").value;
  const city = document.getElementById("city").value;
  const education = document.getElementById("education").value;
  const profession = document.getElementById("profession").value;
  const religion = document.getElementById("religion").value;
  const phone = document.getElementById("phone").value;
  const bio = document.getElementById("bio").value;
  const photoFile = document.getElementById("photo").files[0];

  if(!name || !age || !gender || !photoFile){
    alert("Please fill all required fields and select a photo");
    return;
  }

  // Upload image to Cloudinary
  const formData = new FormData();
  formData.append("file", photoFile);
  formData.append("upload_preset", "profiles"); // Your Cloudinary unsigned preset

  fetch("https://api.cloudinary.com/v1_1/dlsqxs7zl/image/upload", {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    const photoUrl = data.secure_url;

    // Save profile in Firebase
    const profileRef = db.ref("users/" + user.uid);
    profileRef.set({
      name,
      age,
      gender,
      fatherName,
      maritalStatus,
      children,
      city,
      education,
      profession,
      religion,
      phone,
      bio,
      photo: photoUrl,
      status: "pending" // admin approval pending
    })
    .then(()=> {
      alert("Profile submitted successfully! Waiting for admin approval.");
      window.location.href = "index.html";
    })
    .catch(err=>alert("Database error: "+err.message));
  })
  .catch(err => alert("Photo upload failed: "+err.message));
}
</script>

</body>
</html>
