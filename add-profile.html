<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add Profile - Zara Muslim Nikah</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {font-family:Segoe UI; background:#f4f6f9; margin:0; padding:0;}
header {background:#008080; color:white; padding:15px; text-align:center; font-size:22px;}
.container {display:flex; flex-wrap:wrap; justify-content:center; padding:20px;}
.card-form, .preview {background:white; padding:20px; margin:10px; width:350px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.1);}
.card-form input, .card-form select, .card-form textarea, .card-form button {width:100%; padding:10px; margin:8px 0; border-radius:5px; border:1px solid #ccc;}
button {background:#008080; color:white; border:none; cursor:pointer;}
button:hover {background:#006666;}
.preview img {width:100%; max-height:400px; object-fit:contain; border-radius:10px; margin-bottom:10px;}
.preview h3 {margin:5px 0; font-size:20px;}
.preview p {margin:3px 0; color:#555;}
</style>
</head>
<body>

<header>Add Profile</header>

<div class="container">
  <div class="card-form">
    <input id="name" placeholder="Full Name" required>
    <select id="gender" required>
      <option value="">Select Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>
    <input id="fatherName" placeholder="Father's Name" required>
    <input id="motherName" placeholder="Mother's Name">
    <input id="age" type="number" placeholder="Age" required>
    <select id="maritalStatus" onchange="toggleChildren()">
      <option value="">Marital Status</option>
      <option value="Unmarried">Unmarried</option>
      <option value="Married">Married</option>
      <option value="Divorced">Divorced</option>
      <option value="Widowed">Widowed</option>
    </select>
    <input id="children" type="number" placeholder="Number of Children" style="display:none;">
    <input id="city" placeholder="City" required>
    <input id="education" placeholder="Education">
    <input id="profession" placeholder="Profession">
    <input id="religion" placeholder="Religion / Sect">
    <input id="phone" placeholder="Phone / WhatsApp" required>
    <textarea id="bio" placeholder="Short Bio / About Yourself"></textarea>
    <input type="file" id="photo" accept="image/*" required>
    <button onclick="submitProfile()">Submit Profile</button>
  </div>

  <div class="preview" id="preview">
    <h3>Live Preview</h3>
    <img id="previewImg" src="" alt="Profile Image">
    <p><b>Name:</b> <span id="previewName"></span></p>
    <p><b>Gender:</b> <span id="previewGender"></span></p>
    <p><b>Father:</b> <span id="previewFather"></span></p>
    <p><b>Mother:</b> <span id="previewMother"></span></p>
    <p><b>Age:</b> <span id="previewAge"></span></p>
    <p><b>Marital Status:</b> <span id="previewMaritalStatus"></span></p>
    <p><b>Children:</b> <span id="previewChildren"></span></p>
    <p><b>City:</b> <span id="previewCity"></span></p>
    <p><b>Education:</b> <span id="previewEducation"></span></p>
    <p><b>Profession:</b> <span id="previewProfession"></span></p>
    <p><b>Religion:</b> <span id="previewReligion"></span></p>
    <p><b>Phone:</b> <span id="previewPhone"></span></p>
    <p><b>Bio:</b> <span id="previewBio"></span></p>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAhrYtSAdorLMYgBIPeEnXk2nFDG_M65Wc",
  authDomain: "zara-muslim-nikah.firebaseapp.com",
  databaseURL: "https://zara-muslim-nikah-default-rtdb.firebaseio.com",
  projectId: "zara-muslim-nikah"
});

const auth=firebase.auth();
const db=firebase.database();

// Redirect if not logged in
auth.onAuthStateChanged(user=>{
  if(!user) window.location.href="index.html";
});

// Toggle Children input
function toggleChildren(){
  const status=document.getElementById("maritalStatus").value;
  document.getElementById("children").style.display = (status==="Married") ? "block" : "none";
  updatePreview();
}

// Live Preview
const fields = ["name","gender","fatherName","motherName","age","maritalStatus","children","city","education","profession","religion","phone","bio"];
fields.forEach(f=>{
  const el=document.getElementById(f);
  el.addEventListener("input",updatePreview);
});
document.getElementById("photo").addEventListener("change",function(e){
  const file=this.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=function(ev){ document.getElementById("previewImg").src=ev.target.result; }
    reader.readAsDataURL(file);
  }
});

function updatePreview(){
  fields.forEach(f=>{
    let val=document.getElementById(f).value;
    if(f==="children" && document.getElementById("maritalStatus").value!=="Married"){
      val="N/A";
    }
    document.getElementById("preview"+f.charAt(0).toUpperCase()+f.slice(1)).innerText=val;
  });
}

// Submit Profile
function submitProfile(){
  const user = auth.currentUser;
  if(!user){ alert("Login first"); return; }

  const name = document.getElementById("name").value;
  const gender = document.getElementById("gender").value;
  const fatherName = document.getElementById("fatherName").value;
  const motherName = document.getElementById("motherName").value;
  const age = document.getElementById("age").value;
  const maritalStatus = document.getElementById("maritalStatus").value;
  const children = document.getElementById("children").value || 0;
  const city = document.getElementById("city").value;
  const education = document.getElementById("education").value;
  const profession = document.getElementById("profession").value;
  const religion = document.getElementById("religion").value;
  const phone = document.getElementById("phone").value;
  const bio = document.getElementById("bio").value;
  const photoFile = document.getElementById("photo").files[0];

  if(!name || !gender || !fatherName || !age || !city || !phone || !photoFile){
    alert("Please fill all required fields and select a photo");
    return;
  }

  if(maritalStatus==="Married" && !children){
    alert("Please enter number of children");
    return;
  }

  // Cloudinary Upload
  const formData = new FormData();
  formData.append("file", photoFile);
  formData.append("upload_preset", "profiles"); // Your Cloudinary preset

  fetch("https://api.cloudinary.com/v1_1/dlsqxs7zl/image/upload", {
    method:"POST",
    body:formData
  })
  .then(res => res.json())
  .then(data => {
    const photoUrl = data.secure_url;

    // Firebase Save
    db.ref("users/"+user.uid).set({
      name, gender, fatherName, motherName, age, maritalStatus,
      children, city, education, profession, religion, phone, bio,
      photo: photoUrl, status:"pending"
    }).then(()=>{
      alert("Profile submitted! Waiting for admin approval.");
      window.location.href="index.html";
    }).catch(err=>alert("Firebase Error: "+err.message));
  })
  .catch(err => alert("Photo upload failed: "+err.message));
}
</script>

</body>
</html>
